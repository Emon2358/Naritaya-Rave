<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>regahonpo⑧</title>
  <!-- Markdown → HTML 変換用 marked.js -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <style>
    /* 全体設定：背景白、文字オレンジ、モノスペース体 */
    body {
      margin: 0;
      padding: 0;
      background: #ffffff;
      font-family: "Courier New", Courier, monospace;
      color: orange;
    }
    /* 固定ヘッダー（全体高さ 120px） */
    .fixed-header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 120px;
      background: #ffffff;
      z-index: 1000;
      border-bottom: 2px solid orange;
    }
    /* ヘッダー上部：背景画像を横一列に並べて表示（高さ 120px） */
    .header-image-row {
      height: 120px;
      background-image: url('https://sanlabo.net/images/A00000859.jpg?1384752427');
      background-repeat: repeat-x;
      background-size: auto 120px;
    }
    /* ヘッダーオーバーレイ：背景画像と重ねてタイトルとホームボタンを配置 */
    .header-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 20px;
      height: 120px;
      pointer-events: none; /* 背景のクリックを防ぐため */
    }
    .header-title {
      font-size: 36px;
      font-weight: bold;
      color: orange;
      pointer-events: auto;
    }
    .action-btn {
      background: none;
      border: 1px solid orange;
      color: orange;
      padding: 5px 10px;
      cursor: pointer;
      font-size: 14px;
      pointer-events: auto;
    }
    /* 固定左サイドバー */
    .sidebar {
      position: fixed;
      top: 120px; /* ヘッダー下部から */
      left: 0;
      width: 200px;
      bottom: 0;
      background: #ffffff;
      border-right: 2px solid orange;
      padding: 10px;
      box-sizing: border-box;
    }
    .sidebar h2 {
      margin-top: 0;
      font-size: 18px;
    }
    .sidebar ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    .sidebar li {
      margin: 10px 0;
    }
    .sidebar a {
      text-decoration: none;
      color: orange;
      font-weight: bold;
    }
    .sidebar a.active {
      text-decoration: underline;
    }
    /* メインコンテンツ（ヘッダー・サイドバー分の余白を確保） */
    .main-content {
      margin-left: 220px;
      margin-top: 120px;
      padding: 20px;
    }
    /* 各セクション */
    .content-section {
      display: none;
    }
    .content-section h2 {
      margin-top: 0;
    }
    /* ホーム（商品一覧）内のプロフィール表示 */
    #profile-container {
      display: flex;
      align-items: center;
      gap: 20px;
      margin-top: 20px;
    }
    #profile-container img {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      border: 2px solid orange;
    }
    #profile-container a {
      font-size: 24px;
      text-decoration: none;
      color: orange;
      font-weight: bold;
    }
    /* ブログ・お知らせ・BBSの投稿リスト */
    .blog-post, .oshirase-post, .post {
      border-bottom: 1px dashed orange;
      padding: 10px 0;
      cursor: pointer;
    }
    .blog-post h3, .oshirase-post h3, .post h2 {
      margin: 0;
    }
    .date {
      font-size: 0.8rem;
      color: orange;
    }
    
    /* スマホ等の画面幅が狭い場合のレスポンシブ対応 */
    @media screen and (max-width: 768px) {
      /* ヘッダー関連 */
      .fixed-header {
        height: 80px;
      }
      .header-image-row {
        height: 80px;
        background-size: auto 80px;
      }
      .header-overlay {
        height: 80px;
        padding: 0 10px;
      }
      .header-title {
        font-size: 24px;
      }
      .action-btn {
        font-size: 12px;
        padding: 3px 5px;
      }
      /* サイドバーを上部ナビに変更 */
      .sidebar {
        position: static;
        width: 100%;
        height: auto;
        margin-top: 80px; /* ヘッダー分のスペースを確保 */
        border-right: none;
        border-bottom: 2px solid orange;
        padding: 10px 0;
      }
      .sidebar h2 {
        display: none;
      }
      .sidebar ul {
        display: flex;
        justify-content: space-around;
        padding: 0;
        margin: 0;
      }
      .sidebar li {
        margin: 0;
      }
      /* メインコンテンツの余白調整 */
      .main-content {
        margin-left: 0;
        margin-top: 0;
        padding: 10px;
      }
    }
  </style>
</head>
<body>
  <!-- 固定ヘッダー -->
  <header class="fixed-header">
    <div class="header-image-row"></div>
    <div class="header-overlay">
      <div class="header-title">regahonpo</div>
      <button id="home-button" class="action-btn">ホーム</button>
    </div>
  </header>

  <!-- 固定サイドバー（左側／スマホでは上部ナビに変化） -->
  <div class="sidebar">
    <h2>商品一覧</h2>
    <ul>
      <li><a href="#" id="nav-home">ホーム</a></li>
      <li><a href="#" id="nav-blog">ブログ</a></li>
      <li><a href="#" id="nav-bbs">BBS</a></li>
      <li><a href="#" id="nav-oshirase">お知らせ</a></li>
    </ul>
  </div>

  <!-- メインコンテンツエリア -->
  <div class="main-content">
    <!-- ホーム（商品一覧）セクション：GitHubのプロフィール情報を表示 -->
    <div id="section-home" class="content-section">
      <h2>商品一覧</h2>
      <div id="profile-container">
        <img id="profile-avatar" src="" alt="GitHub Avatar">
        <a id="profile-name" href="" target="_blank">GitHub Name</a>
      </div>
    </div>

    <!-- ブログセクション -->
    <div id="section-blog" class="content-section">
      <div id="blog-list">
        <h2>ブログ投稿一覧</h2>
        <div id="blog-posts">
          <p>読み込み中…</p>
        </div>
        <button id="new-blog" class="action-btn">新規ブログ投稿</button>
      </div>
      <div id="blog-detail" style="display:none;">
        <h2 id="blog-title"></h2>
        <div id="blog-content"></div>
        <button id="back-blog" class="action-btn">一覧に戻る</button>
      </div>
    </div>

    <!-- BBSセクション -->
    <div id="section-bbs" class="content-section">
      <h2>BBS投稿一覧</h2>
      <div id="bbs-posts">
        <script src="https://giscus.app/client.js"
                data-repo="Emon2358/regahonpo"
                data-repo-id="R_kgDON4IlGA"
                data-category="Announcements"
                data-category-id="DIC_kwDON4IlGM4Cm4nM"
                data-mapping="pathname"
                data-strict="0"
                data-reactions-enabled="1"
                data-emit-metadata="0"
                data-input-position="bottom"
                data-theme="preferred_color_scheme"
                data-lang="ja"
                crossorigin="anonymous"
                async>
        </script>
      </div>
    </div>

    <!-- お知らせセクション -->
    <div id="section-oshirase" class="content-section">
      <div id="oshirase-list">
        <h2>お知らせ一覧</h2>
        <div id="oshirase-posts">
          <p>読み込み中…</p>
        </div>
        <button id="new-oshirase" class="action-btn">新規お知らせ投稿</button>
      </div>
      <div id="oshirase-detail" style="display:none;">
        <h2 id="oshirase-title"></h2>
        <div id="oshirase-content"></div>
        <button id="back-oshirase" class="action-btn">一覧に戻る</button>
      </div>
    </div>
  </div>

  <script>
    /**********************************
     * GitHub の設定（変更必須）
     **********************************/
    const owner = 'Emon2358';  // 例: 'tanaka'
    const repo  = 'regahonpo';        // 例: 'bbs-repo'

    /**********************************
     * セクション表示・ナビ更新
     **********************************/
    function showSection(sectionId) {
      const sections = document.querySelectorAll('.content-section');
      sections.forEach(sec => sec.style.display = 'none');
      document.getElementById(sectionId).style.display = 'block';
    }
    function updateActiveNav(activeId) {
      const navLinks = document.querySelectorAll('.sidebar a');
      navLinks.forEach(link => { link.classList.remove('active'); });
      if (activeId) {
        document.getElementById(activeId).classList.add('active');
      }
    }
    // 初期表示はホーム
    showSection('section-home');
    updateActiveNav('nav-home');

    /**********************************
     * サイドバー・ヘッダーのナビ操作
     **********************************/
    document.getElementById('home-button').addEventListener('click', function(e) {
      e.preventDefault();
      showSection('section-home');
      updateActiveNav('nav-home');
    });
    document.getElementById('nav-home').addEventListener('click', function(e) {
      e.preventDefault();
      showSection('section-home');
      updateActiveNav('nav-home');
      // ホームは毎回プロフィール情報を更新
      fetchGitHubProfile();
    });
    let blogLoaded = false, bbsLoaded = false, oshiraseLoaded = false;
    document.getElementById('nav-blog').addEventListener('click', function(e) {
      e.preventDefault();
      showSection('section-blog');
      updateActiveNav('nav-blog');
      if (!blogLoaded) { fetchBlogPosts(); blogLoaded = true; }
    });
    document.getElementById('nav-bbs').addEventListener('click', function(e) {
      e.preventDefault();
      showSection('section-bbs');
      updateActiveNav('nav-bbs');
    });
    document.getElementById('nav-oshirase').addEventListener('click', function(e) {
      e.preventDefault();
      showSection('section-oshirase');
      updateActiveNav('nav-oshirase');
      if (!oshiraseLoaded) { fetchOshirasePosts(); oshiraseLoaded = true; }
    });

    /**********************************
     * ホーム：GitHubプロフィール情報の取得
     **********************************/
    async function fetchGitHubProfile() {
      const profileContainer = document.getElementById('profile-container');
      try {
        const response = await fetch(`https://api.github.com/users/${owner}`);
        if (!response.ok) throw new Error('プロフィールの取得に失敗しました。');
        const data = await response.json();
        document.getElementById('profile-avatar').src = data.avatar_url;
        // 名前が設定されていなければ login 名を表示
        document.getElementById('profile-name').textContent = data.name || data.login;
        document.getElementById('profile-name').href = data.html_url;
      } catch (error) {
        console.error(error);
        profileContainer.innerHTML = '<p>プロフィール情報の取得に失敗しました。</p>';
      }
    }
    // 初期表示時にもホーム情報を取得
    fetchGitHubProfile();

    /**********************************
     * ブログ機能（blog フォルダ内の Markdown ファイル）
     **********************************/
    async function fetchBlogPosts() {
      const postsContainer = document.getElementById('blog-posts');
      try {
        const apiUrl = `https://api.github.com/repos/${owner}/${repo}/contents/blog`;
        const response = await fetch(apiUrl);
        if (!response.ok) throw new Error('ブログ投稿の読み込みに失敗しました。');
        const files = await response.json();
        displayBlogPosts(files);
      } catch(error) {
        console.error(error);
        postsContainer.innerHTML = '<p>ブログ投稿の読み込みに失敗しました。</p>';
      }
    }
    function displayBlogPosts(files) {
      const postsContainer = document.getElementById('blog-posts');
      postsContainer.innerHTML = '';
      const mdFiles = files.filter(file => file.name.endsWith('.md'));
      if (mdFiles.length === 0) {
        postsContainer.innerHTML = '<p>現在、ブログ投稿はありません。</p>';
        return;
      }
      mdFiles.sort((a, b) => b.name.localeCompare(a.name));
      mdFiles.forEach(file => {
        const postDiv = document.createElement('div');
        postDiv.className = 'blog-post';
        const title = file.name.replace('.md', '');
        const titleEl = document.createElement('h3');
        titleEl.textContent = title;
        postDiv.appendChild(titleEl);
        postDiv.addEventListener('click', () => { loadBlogPost(file); });
        postsContainer.appendChild(postDiv);
      });
    }
    async function loadBlogPost(file) {
      try {
        const response = await fetch(file.download_url);
        if (!response.ok) throw new Error('ブログ投稿の読み込みに失敗しました。');
        const markdown = await response.text();
        const htmlContent = marked.parse(markdown);
        document.getElementById('blog-title').textContent = file.name.replace('.md', '');
        document.getElementById('blog-content').innerHTML = htmlContent;
        document.getElementById('blog-list').style.display = 'none';
        document.getElementById('blog-detail').style.display = 'block';
      } catch(error) {
        console.error(error);
        alert('ブログ投稿の読み込みに失敗しました。');
      }
    }
    document.getElementById('back-blog').addEventListener('click', function() {
      document.getElementById('blog-detail').style.display = 'none';
      document.getElementById('blog-list').style.display = 'block';
    });
    document.getElementById('new-blog').addEventListener('click', function() {
      window.location.href = `https://github.com/${owner}/${repo}/new/main?filename=blog/`;
    });

    /**********************************
     * お知らせ機能（oshirase フォルダ内の Markdown ファイル）
     **********************************/
    async function fetchOshirasePosts() {
      const postsContainer = document.getElementById('oshirase-posts');
      try {
        const apiUrl = `https://api.github.com/repos/${owner}/${repo}/contents/oshirase`;
        const response = await fetch(apiUrl);
        if (!response.ok) throw new Error('お知らせの読み込みに失敗しました。');
        const files = await response.json();
        displayOshirasePosts(files);
      } catch(error) {
        console.error(error);
        postsContainer.innerHTML = '<p>お知らせの読み込みに失敗しました。</p>';
      }
    }
    function displayOshirasePosts(files) {
      const postsContainer = document.getElementById('oshirase-posts');
      postsContainer.innerHTML = '';
      const mdFiles = files.filter(file => file.name.endsWith('.md'));
      if (mdFiles.length === 0) {
        postsContainer.innerHTML = '<p>現在、お知らせはありません。</p>';
        return;
      }
      mdFiles.sort((a, b) => b.name.localeCompare(a.name));
      mdFiles.forEach(file => {
        const postDiv = document.createElement('div');
        postDiv.className = 'oshirase-post';
        const title = file.name.replace('.md', '');
        const titleEl = document.createElement('h3');
        titleEl.textContent = title;
        postDiv.appendChild(titleEl);
        postDiv.addEventListener('click', () => { loadOshirasePost(file); });
        postsContainer.appendChild(postDiv);
      });
    }
    async function loadOshirasePost(file) {
      try {
        const response = await fetch(file.download_url);
        if (!response.ok) throw new Error('お知らせの読み込みに失敗しました。');
        const markdown = await response.text();
        const htmlContent = marked.parse(markdown);
        document.getElementById('oshirase-title').textContent = file.name.replace('.md', '');
        document.getElementById('oshirase-content').innerHTML = htmlContent;
        document.getElementById('oshirase-list').style.display = 'none';
        document.getElementById('oshirase-detail').style.display = 'block';
      } catch(error) {
        console.error(error);
        alert('お知らせの読み込みに失敗しました。');
      }
    }
    document.getElementById('back-oshirase').addEventListener('click', function() {
      document.getElementById('oshirase-detail').style.display = 'none';
      document.getElementById('oshirase-list').style.display = 'block';
    });
    document.getElementById('new-oshirase').addEventListener('click', function() {
      window.location.href = `https://github.com/${owner}/${repo}/new/main?filename=oshirase/`;
    });
  </script>
</body>
</html>
